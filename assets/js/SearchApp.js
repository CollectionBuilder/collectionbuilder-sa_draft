var SearchApp;SearchApp=(()=>{"use strict";var e={513:(e,t,s)=>{s.r(t),s.d(t,{default:()=>L});class i extends HTMLElement{constructor(){super(),this.classList.add("btn","btn-info","my-2","w-100"),this.classList.add("cursor-pointer")}connectedCallback(){this.attributeChangedCallback("num-applied",void 0,this.getAttribute("num-applied"))}static get observedAttributes(){return["num-applied"]}attributeChangedCallback(e,t,s){const i=parseInt(s,10);this.textContent=`Clear ${i} Filters`,0===i?this.classList.add("d-none"):this.classList.remove("d-none")}}customElements.define("clear-filters",i);class a extends Map{pop(e){if(!this.has(e))return;const t=this.get(e);return this.delete(e),t}}function n(e){const t=document.createElement("div");t.innerHTML=e.trim();const s=t.firstChild;return t.removeChild(s),s}const l=e=>e.split("_").map((e=>e[0].toUpperCase()+e.slice(1))).join(" ");function r(){const e=new a,t=new URLSearchParams(window.location.search);return Array.from(t.entries()).forEach((([t,s])=>{const i=t.endsWith("[]");e.has(t)?i?e.get(t).push(s):console.warn(`Duplicate search key "${t}" does not end with "[]"`):e.set(t,i?[s]:s)})),e}function c(e){const t=new URL(window.location.href);t.search=e,window.history.pushState(null,document.title,t)}function o(e,t,s){if(e.hasAttribute(t))return e.getAttribute(t);if(void 0!==s)return s;throw console.warn(e),new Error(`Element (previous console warning) has no attribute: "${t}"`)}class h extends HTMLElement{constructor(){super(),this.defaultNumVisible=5,this.showAll=!1,this.classList.add("d-block"),this.showMoreEl=n('<button class="btn btn-info w-100 rounded-0 pt-1 pb-1 show-more">\n         show more\n       </button>'),this.showMoreEl.addEventListener("click",this.toggleShowAll.bind(this)),this.appendChild(this.showMoreEl)}connectedCallback(){this.hasAttribute("initial-num-visible")&&(this.defaultNumVisible=parseInt(this.getAttribute("initial-num-visible"),10)),this.valueElsSlice=Array.from(this.querySelectorAll("search-facet-value")).slice(this.defaultNumVisible),0===this.valueElsSlice.length&&(this.showMoreEl.style.display="none"),this.showAllChangeHandler()}showAllChangeHandler(){this.querySelector(".show-more").textContent=this.showAll?"show fewer":"show more";const e=this.showAll?"d-flex":"d-none",t=this.showAll?"d-none":"d-flex";this.valueElsSlice.forEach((s=>{s.classList.remove(t),s.classList.add(e)}))}toggleShowAll(){this.showAll=!this.showAll,this.showAllChangeHandler()}}customElements.define("search-facet-values",h);class d extends HTMLElement{constructor(){super(),this.classList.add("d-flex","py-1","px-2","btn","btn-light","border-bottom","rounded-0"),this.classList.add("cursor-pointer"),this.innerHTML='<span class="text-truncate pr-2 name"></span>\n       <span class="ml-auto doc-count"></span>\n      '}connectedCallback(){const e=this.getAttribute("value"),t=this.getAttribute("doc-count"),s=this.hasAttribute("selected"),i=this.querySelector(".name");i.textContent=e,i.setAttribute("title",e),this.querySelector(".doc-count").textContent=s?"x":t,s&&(this.classList.remove("btn-light"),this.classList.add("btn-info"))}}customElements.define("search-facet-value",d);class u extends HTMLElement{constructor(){super(),this.collapsed=!1,this.valueClickListeners=[],this.name=void 0,this.displayName=void 0,this.classList.add("d-block","border","border-secondary","rounded","overflow-hidden","mb-4","w-100"),this.appendChild(n('<h1 class="d-flex bg-dark text-white-50 font-weight-bold p-2 mb-0 text-nowrap h6\n                  cursor-pointer">\n         <span class="name"></span>\n         <span class="font-weight-bold text-monospace ml-auto collapsed-icon">-</span>\n       </h1>')),this.appendChild(n("<slot></slot>"))}connectedCallback(){this.name=this.getAttribute("name"),this.displayName=this.getAttribute("display-name");const e=this.querySelector("search-facet-values");this.querySelector("slot").replaceWith(e),this.hasAttribute("collapsed")&&this.toggleCollapsed(),this.querySelector("h1 > span.name").textContent=this.displayName,this.querySelector("h1").addEventListener("click",this.toggleCollapsed.bind(this)),this.querySelector("search-facet-values").addEventListener("click",this.valueClickHandler.bind(this))}toggleCollapsed(){this.collapsed=!this.collapsed,this.querySelector("h1 > span.collapsed-icon").textContent=this.collapsed?"+":"-";const e=this.querySelector("search-facet-values");this.collapsed?(e.classList.remove("d-block"),e.classList.add("d-none")):(e.classList.remove("d-none"),e.classList.add("d-block"))}addValueClickListener(e){this.valueClickListeners.push(e)}removeValueClickListener(e){for(let t=0;t<this.valueClickListeners.length;t+=1)if(this.valueClickListeners[t]===e)return void this.valueClickListeners.splice(t,1)}valueClickHandler(e){const t=e.target.closest("search-facet-value");if(null===t)return;const s=t.getAttribute("value");this.valueClickListeners.forEach((e=>e(this.name,s)))}}customElements.define("search-facet",u);class p extends u{constructor(e){super(),this.setAttribute("collapsed","");const t=n(`<search-facet-values>\n        <search-facet-value\n           value="Go to the multi-collection search page to access ${e} additional collections"\n           doc-count="">\n        </search-facet-value>\n      </search-facet-values>`);t.querySelector("search-facet-value .name").classList.remove("text-truncate"),this.valueClickHandler=e=>{e.stopPropagation(),window.location.pathname="/multi-collection-search/"},this.appendChild(t)}connectedCallback(){this.setAttribute("name","other-collections"),this.setAttribute("display-name","Other Collections"),super.connectedCallback()}}customElements.define("multi-collection-cta-facet",p);class f extends HTMLElement{constructor(e,t){super(),this.aggregations=e,this.includeKeys=t,this.valueClickListeners=[]}connectedCallback(){(this.includeKeys||Object.keys(this.aggregations)).forEach((e=>{const{buckets:t}=this.aggregations[e];if(0===t.length)return;const s=(i=e,new URLSearchParams(window.location.search).getAll(`${i}[]`)).reverse();var i;t.sort(((e,t)=>s.indexOf(t.key)-s.indexOf(e.key)));const a=n(`<search-facet name="${e}" display-name="${l(e)}">\n           <search-facet-values initial-num-visible="5">\n             ${t.map((e=>`<search-facet-value value="${e.key}"\n                             doc-count="${e.doc_count}"\n                             ${s.includes(e.key)?"selected":""}>\n         </search-facet-value>`)).join("")}\n           </search-facet-values>\n         </search-facet>`);this.appendChild(a);const r=a.querySelectorAll("search-facet-value");r[r.length-1].classList.remove("border-bottom"),a.addValueClickListener(this.valueClickHandler.bind(this))}))}addValueClickListener(e){this.valueClickListeners.push(e)}removeValueClickListener(e){for(let t=0;t<this.valueClickListeners.length;t+=1)if(this.valueClickListeners[t]===e)return void this.valueClickListeners.splice(t,1)}valueClickHandler(e,t){this.valueClickListeners.forEach((s=>s(e,t)))}}customElements.define("search-facets",f);class m extends HTMLButtonElement{constructor(e,t,s,i=!1){super(),this.innerHTML=e,this.start=t,this.disabled=s,this.classList.add("mr-1","btn"),i?this.classList.add("btn-primary"):this.classList.add("btn-light","border-secondary")}}customElements.define("paginator-button",m,{extends:"button"});const g=n('<span class="position-relative" style="top: .4em">&#8230;</span>');class v extends HTMLElement{connectedCallback(){const e=parseInt(o(this,"num-total"),10),t=parseInt(o(this,"page-size"),10),s=parseInt(o(this,"current-page"),10),i=Math.floor(e/t)+1,a=s>3,n=i-s>2,l=e=>t*(e-1);this.appendChild(new m("&laquo;&nbsp;prev",l(s-1),1===s)),a&&(this.appendChild(new m("1",1,!1)),this.appendChild(g.cloneNode(!0)));let r=-2;for(;r<=2;){const e=s+r;if(e>0&&(1!==e||!a)&&(e!==i||!n)&&e<=i){const t=e===s;this.appendChild(new m(`${e}`,l(e),t,t))}r+=1}n&&(this.appendChild(g.cloneNode(!0)),this.appendChild(new m(`${i}`,l(i),!1)));const c=new m("next&nbsp;&raquo;",l(s+1),s===i);this.appendChild(c),c.classList.remove("mr-1")}}customElements.define("paginator-control",v);class y extends HTMLSelectElement{constructor(){super(),this.classList.add("bg-white")}connectedCallback(){const e=this.getAttribute("value"),t=this.getAttribute("options").split(",");t.includes(e)||t.push(e),t.forEach((t=>{this.appendChild(n(`<option value="${t}"\n                 ${t===e?"selected":""}>\n           ${t}\n         </option>\n        `))}))}}customElements.define("page-size-selector",y,{extends:"select"});class b extends HTMLElement{constructor(e,t,s){super(),this.numHits=e,this.start=t,this.size=s,this.startIdx=t+1,this.endIdx=this.startIdx+Math.min(e-this.startIdx,s-1),this.classList.add("d-flex")}connectedCallback(){if(this.endIdx<this.startIdx)return this.classList.add("bg-warning","text-dark","p-3"),void(this.textContent=`Query "start" value (${this.start}) exceeds the number of total results (${this.numHits})`);this.innerHTML=`<span class="h4 text-nowrap">\n         Showing ${this.startIdx} - ${this.endIdx} of ${this.numHits} Results\n       </span>\n       <div class="ml-auto text-right">\n         <span class="text-nowrap">\n           <label for="results-per-page">Results per page</label>\n           <select is="page-size-selector" value="${this.size}" options="10,25,50,100"\n                   class="cursor-pointer">\n           </select>\n         </span>\n         <paginator-control num-total="${this.numHits}" page-size="${this.size}"\n                            current-page="${Math.floor(this.startIdx/this.size)+1}"\n                            class="d-block mt-1 mb-2">\n         </paginator-control>\n       </div>\n      `}}customElements.define("search-results-header",b);class w extends HTMLElement{constructor(e,t,s){super(),this.classList.add("d-flex","border-top","p-4"),this.innerHTML=`<a href="${e.url}">\n         <img src="${e.thumbnailContentUrl}" style="width: 100px">\n       </a>\n       <div class="details">\n         <h1 class="h4 ml-3">\n           <a href="${e.url}">${e[t[0]]}</a>\n         </h1>\n         \x3c!-- Non-title display fields will be appended here --\x3e\n       </div>`;const i=this.querySelector(".details");s&&i.appendChild(n(`<p class="ml-3 mb-1">\n             Collection: <a href="${e.collectionUrl}">${e.collectionTitle}</a>\n           </p>`)),t.slice(1).forEach((t=>{const s=e[t];void 0!==s&&i.appendChild(n(`<p class="ml-3 mb-1">${l(t)}: ${s}</p>`))}))}}customElements.define("search-result",w);class C extends HTMLElement{constructor(e,t,s){super(),this.hits=e,this.displayFields=t,this.isMulti=s}connectedCallback(){this.hits.forEach((e=>{this.appendChild(new w(e._source,this.displayFields,this.isMulti))}))}}async function x(e,t,s){let i,a;try{i=await fetch(`${e}/${t.join(",")}/_search`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})}catch(e){return null}if(!i.headers.get("Content-Type").startsWith("application/json"))return null;try{a=await i.json()}catch(e){return null}return i.ok?a:(a.error&&a.error.reason&&console.error(`Search error: ${a.error.reason}`),null)}customElements.define("search-results",C);class L extends HTMLElement{constructor(){super(),this.indicesDirectoryIndexTitleMap=new Map,this.indicesDirectoryTitleIndexMap=new Map,this.style.fontSize="1rem",this.appendChild(n('\n      <div class="container position-relative">\n\n        <div id="search-overlay" class="position-absolute w-100 h-100 d-flex"\n             style="top: 0; background-color: rgba(255, 255, 255, 0.5);">\n          <div class="spinner-border ml-auto mr-auto" role="status">\n            <span class="sr-only">Loading...</span>\n          </div>\n        </div>\n\n        <div class="row">\n          <div class="col-4 facets"></div>\n          <div class="col">\n            <input type="text" class="form-control mb-2" placeholder="Search" aria-label="search box">\n            <clear-filters num-applied="0"></clear-filters>\n            <div class="results-header"></div>\n            <div class="results"></div>\n          </div>\n        </div>\n      </div>\n      ')),this.searchOverlay=this.querySelector("#search-overlay"),this.searchOverlay.remove(),this.clearFiltersButton=this.querySelector("clear-filters"),this.searchInput=this.querySelector("input[type=text]");const e=r();e.has("q")&&(this.searchInput.value=e.get("q"))}async connectedCallback(){const e=this.getAttribute("elasticsearch-url");try{this.esUrl=new URL(e).origin}catch(e){throw new Error('Please specify a valid <es-search> element "elasticsearch-url" value')}if(this.esIndex=this.getAttribute("elasticsearch-index"),!this.esIndex)throw new Error('Please specify a valid <es-search> element "elasticsearch-index" value');if(this.hasAttribute("fields")){let e=this.getAttribute("fields");e=e.split(","),this.allFields=e.slice(0,e.length-1)}else this.allFields=[];if(this.hasAttribute("faceted-fields")){let e=this.getAttribute("faceted-fields");e=e.split(","),this.facetedFields=e.slice(0,e.length-1)}else this.facetedFields=[];if(this.hasAttribute("display-fields")){let e=this.getAttribute("display-fields");e=e.split(","),this.displayFields=e.slice(0,e.length-1)}else this.displayFields=[];this.isMulti=this.hasAttribute("search-multi"),(await async function(e){const t=await await fetch(`${e}/directory_/_search`);return 200===t.status?(await t.json()).hits.hits.map((e=>e._source)):(console.error("Unable to retrieve the indices directory from the Elasticsearch server"),[])}(this.esUrl)).forEach((({index:e,title:t})=>{this.indicesDirectoryIndexTitleMap.set(e,t),this.indicesDirectoryTitleIndexMap.set(t,e)})),this.searchInput.addEventListener("keydown",this.searchInputKeydownHandler.bind(this)),this.clearFiltersButton.addEventListener("click",this.clearFiltersClickHandler.bind(this)),window.addEventListener("popstate",(()=>this.search.bind(this)())),this.search()}async search(){this.showOverlay();const e=r();let t,s=0;this.isMulti?(t=e.get("collection[]"),t?(e.delete("collection[]"),s+=t.length):t=Array.from(this.indicesDirectoryTitleIndexMap.keys())):t=[this.indicesDirectoryIndexTitleMap.get(this.esIndex)];const i=t.map((e=>this.indicesDirectoryTitleIndexMap.get(e))),a=e.pop("q")||"",n=parseInt(e.pop("start")||0,10),l=parseInt(e.pop("size")||10,10);let c=["*"];e.has("fields")&&(c=e.pop("fields").split(","));const o=new Map;Array.from(e.entries()).forEach((([e,t])=>{const i=e.endsWith("[]"),a=`${i?e.slice(0,e.length-2):e}.raw`,n=i?t:[t];o.set(a,n),s+=n.length}));const h=new Map;this.facetedFields.forEach((e=>h.set(e,`${e}.raw`)));const d=function(e,{q:t="",filters:s={},start:i=0,size:a=10,fields:n=["*"],aggregationNameFieldMap:l={},_source:r="*"}){let c={match_all:{}};t.length>0&&(c={simple_query_string:{query:t,default_operator:"and",fields:n}});const o=[];Array.from(s.entries()).forEach((([e,t])=>{(Array.isArray(t)?t:[t]).forEach((t=>{o.push({term:{[e]:t}})}))}));const h={from:i,size:a,query:{}};return 0===o.length?h.query=c:h.query={bool:{must:c,filter:o}},h.aggs={},Array.from(l.entries()).forEach((([e,t])=>{h.aggs[e]={terms:{field:t,size:25}}})),h._source=r,h}(0,{q:a,filters:o,start:n,size:l,fields:c,aggregationNameFieldMap:h,_source:{excludes:["full_text"]}}),u=Array.from(this.indicesDirectoryIndexTitleMap.keys()),p={size:0,query:d.query,aggs:{collection:{terms:{field:"_index",size:u.length}}}},[f,m]=await Promise.all([x(this.esUrl,i,d),x(this.esUrl,u,p)]),g=m.aggregations.collection,v=g.buckets.map((({key:e})=>e));u.filter((e=>!v.includes(e))).forEach((e=>g.buckets.push({key:e,doc_count:0})));for(let e=0;e<g.buckets.length;e+=1){const t=g.buckets[e];t.key=this.indicesDirectoryIndexTitleMap.get(t.key)}f.aggregations.collection=g,this.clearFiltersButton.setAttribute("num-applied",s),this.renderFacets(f.aggregations),this.renderResultsHeader(f.hits.total.value,n,l),this.renderResults(f.hits.hits),this.hideOverlay()}showOverlay(){this.querySelector(".container").appendChild(this.searchOverlay)}hideOverlay(){this.searchOverlay.remove()}async renderFacets(e){const t=this.querySelector("div.facets");let s=t.querySelector("search-facets");null!==s&&s.remove();let i=this.facetedFields;if(this.isMulti&&(i=["collection"].concat(i)),s=new f(e,i),s.addValueClickListener(this.facetValueClickHandler.bind(this)),t.appendChild(s),!this.isMulti){const e=this.indicesDirectoryIndexTitleMap.size-1,t=new p(e);s.insertBefore(t,s.children[0])}}async renderResultsHeader(e,t,s){const i=this.querySelector("div.results-header");var a;a=i,Array.from(a.children).forEach((e=>e.remove()));const n=new b(e,t,s);i.appendChild(n),n.querySelector("select[is=page-size-selector]").addEventListener("change",this.pageSizeSelectorChangeHandler.bind(this)),n.querySelector("paginator-control").addEventListener("click",this.paginatorClickHandler.bind(this))}async renderResults(e){const t=this.querySelector("div.results");let s=t.querySelector("search-results");null!==s&&s.remove(),s=new C(e,this.displayFields,this.isMulti),t.appendChild(s)}facetValueClickHandler(e,t){const s=new URLSearchParams(window.location.search),i=`${e}[]`;let a=s.getAll(i);a.includes(t)?a=a.filter((e=>e!==t)):a.push(t),s.delete(i),a.forEach((e=>s.append(i,e))),s.delete("start"),c(s),this.search()}searchInputKeydownHandler(e){if("Enter"!==e.key)return;const t=e.target;t.blur();const s=t.value,i=new URLSearchParams(window.location.search);i.set("q",s),c(i),this.search()}pageSizeSelectorChangeHandler(e){const t=e.target.value,s=new URLSearchParams(window.location.search);s.set("size",t),c(s),this.search()}clearFiltersClickHandler(e){e.stopPropagation();const t=new URLSearchParams(window.location.search);new Set(Array.from(t.keys()).filter((e=>e.endsWith("[]")))).forEach((e=>t.delete(e))),t.delete("start"),c(t),this.search()}paginatorClickHandler(e){e.stopPropagation();const{target:t}=e;if("BUTTON"!==t.tagName)return;const{start:s}=t,i=new URLSearchParams(window.location.search);0===s?i.delete("start"):i.set("start",s),c(i),this.search()}}customElements.define("search-app",L)}},t={};function s(i){if(t[i])return t[i].exports;var a=t[i]={exports:{}};return e[i](a,a.exports,s),a.exports}return s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s(513)})();